<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Profilo ID</th>
      <th>Shop ID</th>
      <th>Data Ordine</th>
      <th>Totale</th>
      <th>Stato</th>
      <th>Tracking ID</th>
      <th>Data Consegna Stimata</th>
      <th>Azioni</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let order of orders">
      <td>{{ order.id }}</td>
      <td>{{ order.customer?.id }}</td>
      <td>{{ order.shop?.id }}</td>
      <td>{{ order.orderDate | date:'dd/MM/yyyy' }}</td>
      <td>{{ order.total | currency:'EUR' }}</td>
      <td>{{ order.status }}</td>
      <td>{{ order.trackingId || 'N/A' }}</td>
      
      <td [style.background-color]="(role === 'SELLER' && helper.isExpired(order)) ? '#ffdada' : 'transparent'">
        <span [class.expired]="helper.isExpired(order)">
          {{ order.estimatedDeliveryDate ? (order.estimatedDeliveryDate | date:'dd/MM/yyyy') : 'N/A' }}
        </span>
      </td>

      <td>
        <ng-container *ngIf="role === 'SELLER'">
          <div *ngIf="helper.canSellerShip(order)">
            <input
              type="text"
              placeholder="Tracking ID"
              [(ngModel)]="order._trackingTemp"
            />
            <input
              type="date"
              [(ngModel)]="order._estimatedTemp"
              [min]="todayString"
            />
            <button
              type="button"
              (click)="shipOrder(order)"
              [disabled]="!order._trackingTemp || !order._estimatedTemp">
              Conferma spedizione
            </button>
          </div>

          <div *ngIf="helper.isExpired(order)" class="expired">
             Consegna non ancora confermata
          </div>
        </ng-container>

        <ng-container *ngIf="role === 'CUSTOMER'">
          <button
            type="button"
            (click)="confirmDelivery(order)"
            [disabled]="!helper.canCustomerConfirm(order)"
            [ngStyle]="helper.canCustomerConfirm(order) ? {'background-color': '#27ae60', 'color': 'white', 'border-color': '#27ae60'} : {}">
            Conferma consegna
          </button>

          <div
            *ngIf="order.status === 'SHIPPED' && !helper.canCustomerConfirm(order)"
            class="info-text">
            Disponibile dal {{ order.estimatedDeliveryDate | date:'dd/MM/yyyy' }}
          </div>
        </ng-container>
      </td>
    </tr>
  </tbody>
</table>