<h2 class="page-title">Lista Prodotti</h2>

<div class="header-actions">
  <button class="btn btn-secondary" [routerLink]="['/profiles', profileId, 'shops']">
    Torna ai Negozi
  </button>

  <button *ngIf="isOwner" class="btn btn-primary" (click)="onAddProduct()">
    + Nuovo Prodotto
  </button>

  <button *ngIf="userRole === 'CUSTOMER'" 
          class="btn btn-cart-nav" 
          [routerLink]="['/profiles', profileId, 'shops', shopId, 'cart']">
     Vai al Carrello
  </button>
</div>

<div class="shop-grid" *ngIf="!loading && products.length > 0">
  <div class="shop-card" 
       *ngFor="let product of products"
       [ngClass]="{'disabled-card': product.quantity === 0 || isFutureDate(product.availabilityDate)}">
    
    <div class="shop-image-container">
      <img src="assets/product-placeholder.png" class="shop-image" alt="prodotto">
    </div>

    <div class="product-info">
      <div class="product-title">{{ product.name }}</div>
      <p>{{ product.description }}</p>
      <p><strong>Prezzo:</strong> {{ product.price }}€</p>
      
      <p>
        <strong>Disponibilità:</strong> 
        {{ product.quantity }}
      </p>

      <p class="shop-category-text" *ngIf="isFutureDate(product.availabilityDate)">
        Disponibile dal: {{ product.availabilityDate | date:'dd/MM/yyyy' }}
      </p>
    </div>

    <div class="profile-buttons">
      <button class="btn btn-info" (click)="onViewDetails(product.id)">
        Maggiori Informazioni
      </button>

      <button *ngIf="userRole === 'CUSTOMER'" 
              class="btn btn-add" 
              [disabled]="product.quantity === 0 || isFutureDate(product.availabilityDate)"
              (click)="onAddToCart(product)">
        {{ product.quantity === 0 ? 'Esaurito' : 'Aggiungi al carrello' }}
      </button>

      <ng-container *ngIf="isOwner">
        <button class="btn btn-edit" (click)="onEditProduct(product)">
          Modifica
        </button>
        <button class="btn btn-danger" (click)="onDeleteProduct(product.id)">
          Elimina
        </button>
      </ng-container>
    </div>
  </div>
</div>

<div class="no-products" *ngIf="!loading && products.length === 0">
  <p>Nessun prodotto disponibile in questo negozio.</p>
</div>